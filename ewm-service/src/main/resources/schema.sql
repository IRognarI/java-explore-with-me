drop table if exists participation;
drop table if exists compiled_events;
drop table if exists compilations;
drop table if exists events;
drop table if exists categories;
drop table if exists users;

create table if not exists users (
    id bigint generated by default as identity primary key not null,
    name varchar(250) not null unique,
    email varchar(254) not null unique
);

create table if not exists categories (
    id bigint generated by default as identity primary key not null,
    name varchar(50) not null unique
);

create table if not exists events (
    id bigint generated by default as identity primary key not null,
    annotation varchar(2000) not null,
    category_id bigint references categories not null,
    initiator_id bigint references users not null,
    description varchar(7000) not null,
    event_date timestamp without time zone not null,
    location_lat float not null,
    location_lon float not null,
    paid boolean not null default false,
    participant_limit integer not null default 0,
    confirmed_requests integer not null default 0,
    request_moderation boolean not null default true,
    created_on timestamp without time zone not null,
    published_on timestamp without time zone,
    state varchar(10) not null,
    title varchar(120) not null
);

create table if not exists compilations (
    id bigint generated by default as identity primary key not null,
    title varchar(50) not null,
    pinned boolean not null
);

create table if not exists compiled_events (
    id bigint generated by default as identity primary key not null,
    compilation_id bigint references compilations not null,
    event_id bigint references events not null
);

create table if not exists participation (
    id bigint generated by default as identity primary key not null,
    event_id bigint references events not null,
    requester_id bigint references users not null,
    status varchar(16) not null,
    created timestamp without time zone not null
);